# ğŸ“Š ë°ì´í„° í™•ë³´ ë° ë³´ì¶© ìë™í™” ë„êµ¬

2024~2025ë…„ ì „ì²´ íƒ€ì„í”„ë ˆì„ ë°ì´í„°ë¥¼ ì™„ì „í•˜ê²Œ í™•ë³´í•˜ê¸° ìœ„í•œ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸ¯ ëª©ì 

- **ë¬¸ì œ**: minute5ëŠ” 2024-08-26ë¶€í„° ì‹œì‘ (1~8ì›” ëˆ„ë½)
- **ëª©í‘œ**: 2024-01-01 ~ 2025-12-31 ì „ì²´ ë°ì´í„° í™•ë³´
- **ë°©ë²•**: ì—…ë¹„íŠ¸ API ìˆ˜ì§‘ + ì„ í˜•ë³´ê°„

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
automation/
â”œâ”€â”€ README.md                      # ì´ íŒŒì¼
â”œâ”€â”€ verify_all_timeframes.py       # 1. ë°ì´í„° ê²€ì¦ ë„êµ¬
â”œâ”€â”€ collect_missing_data.py        # 2. ëˆ„ë½ ë°ì´í„° ìˆ˜ì§‘
â””â”€â”€ interpolate_gaps.py            # 3. ì„ í˜•ë³´ê°„ ì²˜ë¦¬
```

---

## ğŸš€ ì‚¬ìš© ë°©ë²•

### Step 1: ë°ì´í„° ê²€ì¦
**í˜„ì¬ DB ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ëˆ„ë½ êµ¬ê°„ì„ ì‹ë³„í•©ë‹ˆë‹¤.**

```bash
cd /Users/bongbong/SynologyDrive/vendor/sandbox/251015_ë´‰ë´‡
python automation/verify_all_timeframes.py
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
============================================================
ğŸ“Š ê²€ì¦ ìš”ì•½
============================================================

ì™„ì „í•œ íƒ€ì„í”„ë ˆì„: 0/6
  âŒ minute5     :  56.93% (ëˆ„ë½: 90,560ê°œ)
  âŒ minute15    :  89.66% (ëˆ„ë½: 7,247ê°œ)
  âŒ minute30    :  89.66% (ëˆ„ë½: 3,623ê°œ)
  âŒ minute60    :  89.66% (ëˆ„ë½: 1,811ê°œ)
  âŒ minute240   :  89.66% (ëˆ„ë½: 453ê°œ)
  âŒ day         :  89.73% (ëˆ„ë½: 75ê°œ)

âœ… ê²€ì¦ ë¦¬í¬íŠ¸ ì €ì¥: data_gap_report.json
```

**ìƒì„± íŒŒì¼:**
- `data_gap_report.json` - ìƒì„¸ ê²€ì¦ ê²°ê³¼

---

### Step 2: ëˆ„ë½ ë°ì´í„° ìˆ˜ì§‘
**ì—…ë¹„íŠ¸ APIë¥¼ í†µí•´ ëˆ„ë½ëœ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.**

```bash
python automation/collect_missing_data.py
```

**íŠ¹ì§•:**
- âœ… ìë™ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„°ì™€ ë¹„êµí•˜ì—¬ ëˆ„ë½ë¶„ë§Œ ìˆ˜ì§‘
- âœ… ì¤‘ë‹¨í•´ë„ ì§„í–‰ëœ ë°ì´í„°ëŠ” ì €ì¥ë¨
- âœ… ì¬ì‹¤í–‰ ì‹œ ì´ì–´ì„œ ìˆ˜ì§‘ (ì¤‘ë³µ ì²´í¬)
- âœ… API Rate Limit ìë™ ì¤€ìˆ˜ (ì´ˆë‹¹ 10íšŒ)

**ì˜ˆìƒ ì†Œìš” ì‹œê°„:**
- minute5: ~1ì‹œê°„ (90,560ê°œ ìº”ë“¤)
- minute15: ~15ë¶„ (7,247ê°œ ìº”ë“¤)
- minute30: ~8ë¶„ (3,623ê°œ ìº”ë“¤)
- minute60: ~4ë¶„ (1,811ê°œ ìº”ë“¤)
- minute240: ~1ë¶„ (453ê°œ ìº”ë“¤)
- day: ~10ì´ˆ (75ê°œ ìº”ë“¤)

**ì£¼ì˜ì‚¬í•­:**
- ì‹¤í–‰ ì¤‘ `Ctrl+C`ë¡œ ì–¸ì œë“ ì§€ ì¤‘ë‹¨ ê°€ëŠ¥
- ì¤‘ë‹¨ ì‹œì—ë„ ì§„í–‰ëœ ë°ì´í„°ëŠ” ë³´ì¡´ë¨
- ì¬ì‹¤í–‰í•˜ë©´ ì´ì–´ì„œ ìˆ˜ì§‘ë¨

---

### Step 3: ì„ í˜•ë³´ê°„ ì²˜ë¦¬
**APIì—ì„œë„ ì—†ëŠ” ë¯¸ì„¸ ëˆ„ë½ êµ¬ê°„ì„ ì„ í˜•ë³´ê°„ìœ¼ë¡œ ì±„ì›ë‹ˆë‹¤.**

```bash
python automation/interpolate_gaps.py
```

**ì²˜ë¦¬ ë°©ë²•:**
```python
# ì´ì „ ìº”ë“¤: ì‹œê°€ 100,000ì›
# ë‹¤ìŒ ìº”ë“¤: ì‹œê°€ 102,000ì›
# ëˆ„ë½ ìº”ë“¤ 2ê°œ

# ë³´ê°„ ê²°ê³¼:
# ëˆ„ë½ 1: 100,000 + (102,000 - 100,000) * 1/3 = 100,667ì›
# ëˆ„ë½ 2: 100,000 + (102,000 - 100,000) * 2/3 = 101,333ì›
```

**ë³´ê°„ ë°ì´í„° í‘œì‹œ:**
- DB ì»¬ëŸ¼ `is_interpolated = 1`ë¡œ í‘œì‹œ
- ì›ë³¸ ë°ì´í„°ì™€ êµ¬ë¶„ ê°€ëŠ¥

---

### Step 4: ìµœì¢… ê²€ì¦
**ëª¨ë“  ë°ì´í„°ê°€ ì™„ì „í•œì§€ ì¬í™•ì¸í•©ë‹ˆë‹¤.**

```bash
python automation/verify_all_timeframes.py
```

**ì„±ê³µ ê¸°ì¤€:**
```
ì™„ì „í•œ íƒ€ì„í”„ë ˆì„: 6/6
  âœ… minute5     : 100.00% (ëˆ„ë½: 0ê°œ)
  âœ… minute15    : 100.00% (ëˆ„ë½: 0ê°œ)
  âœ… minute30    : 100.00% (ëˆ„ë½: 0ê°œ)
  âœ… minute60    : 100.00% (ëˆ„ë½: 0ê°œ)
  âœ… minute240   : 100.00% (ëˆ„ë½: 0ê°œ)
  âœ… day         : 100.00% (ëˆ„ë½: 0ê°œ)
```

---

## ğŸ”„ ì „ì²´ ì‹¤í–‰ ì˜ˆì‹œ

```bash
cd /Users/bongbong/SynologyDrive/vendor/sandbox/251015_ë´‰ë´‡

# 1. í˜„ì¬ ìƒíƒœ í™•ì¸
python automation/verify_all_timeframes.py

# 2. ë°ì´í„° ë°±ì—… (ì„ íƒì‚¬í•­)
cp upbit_bitcoin.db upbit_bitcoin_backup_$(date +%Y%m%d).db

# 3. ëˆ„ë½ ë°ì´í„° ìˆ˜ì§‘ (ì‹œê°„ ì†Œìš”)
python automation/collect_missing_data.py

# 4. ì„ í˜•ë³´ê°„ ì²˜ë¦¬
python automation/interpolate_gaps.py

# 5. ìµœì¢… ê²€ì¦
python automation/verify_all_timeframes.py

# 6. DB í¬ê¸° í™•ì¸
ls -lh upbit_bitcoin.db
```

---

## ğŸ“Š ì˜ˆìƒ ê²°ê³¼

### ìˆ˜ì§‘ ì „ (í˜„ì¬)
```
DB í¬ê¸°: 489MB
minute5: 119,680ê°œ (2024-08-26 ~ 2025-10-16)
```

### ìˆ˜ì§‘ í›„ (ì˜ˆìƒ)
```
DB í¬ê¸°: ~520MB (+31MB)
minute5: 210,240ê°œ (2024-01-01 ~ 2025-12-31) âœ…
minute15: 70,080ê°œ (2024-01-01 ~ 2025-12-31) âœ…
minute30: 35,040ê°œ (2024-01-01 ~ 2025-12-31) âœ…
minute60: 17,520ê°œ (2024-01-01 ~ 2025-12-31) âœ…
minute240: 4,380ê°œ (2024-01-01 ~ 2025-12-31) âœ…
day: 730ê°œ (2024-01-01 ~ 2025-12-31) âœ…
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. API Rate Limit
- ì—…ë¹„íŠ¸: ì´ˆë‹¹ 10íšŒ ì œí•œ
- ìŠ¤í¬ë¦½íŠ¸ì— ìë™ìœ¼ë¡œ êµ¬í˜„ë¨ (`time.sleep(0.1)`)

### 2. ë””ìŠ¤í¬ ìš©ëŸ‰
```bash
# ì‹¤í–‰ ì „ í™•ì¸
df -h .
# ìµœì†Œ 1GB ì—¬ìœ  ê³µê°„ í•„ìš”
```

### 3. ì¤‘ë‹¨ ë° ì¬ì‹¤í–‰
- `Ctrl+C`ë¡œ ì•ˆì „í•˜ê²Œ ì¤‘ë‹¨ ê°€ëŠ¥
- ì§„í–‰ëœ ë°ì´í„°ëŠ” ìë™ ì €ì¥
- ì¬ì‹¤í–‰ ì‹œ ì¤‘ë³µ ì²´í¬ë¡œ ì´ì–´ì„œ ìˆ˜ì§‘

### 4. ë°ì´í„° ë°±ì—…
```bash
# ìˆ˜ì§‘ ì „ ë°±ì—… ê¶Œì¥
cp upbit_bitcoin.db upbit_bitcoin_backup.db
```

---

## ğŸ› ï¸ ë¬¸ì œ í•´ê²°

### Python ëª¨ë“ˆ ì—†ìŒ
```bash
cd upbit_history_db
source venv/bin/activate
pip install -r requirements.txt
```

### Permission denied
```bash
chmod +x automation/*.py
```

### DB locked ì—ëŸ¬
```bash
# ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ DBë¥¼ ì‚¬ìš© ì¤‘
ps aux | grep python
kill <PID>
```

### ìˆ˜ì§‘ ì¤‘ë‹¨ í›„ ì¬ê°œ
```bash
# ë‹¨ìˆœíˆ ë‹¤ì‹œ ì‹¤í–‰
python automation/collect_missing_data.py
# ìë™ìœ¼ë¡œ ì¤‘ë³µ ì²´í¬í•˜ì—¬ ëˆ„ë½ë¶„ë§Œ ìˆ˜ì§‘
```

---

## ğŸ“ˆ ì§„í–‰ ìƒí™© ëª¨ë‹ˆí„°ë§

### ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
```bash
# ìˆ˜ì§‘ ì¤‘ì¸ ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ
watch -n 5 "sqlite3 upbit_bitcoin.db 'SELECT COUNT(*) FROM bitcoin_minute5'"
```

### DB í¬ê¸° ëª¨ë‹ˆí„°ë§
```bash
watch -n 30 "ls -lh upbit_bitcoin.db"
```

---

## ğŸ” ì¶”ê°€ ë„êµ¬

### íŠ¹ì • íƒ€ì„í”„ë ˆì„ë§Œ ìˆ˜ì§‘
```python
# collect_missing_data.py ìˆ˜ì •
# collector.collect_all_timeframes() ëŒ€ì‹ :
collector.collect_all_data('minute5')
```

### íŠ¹ì • ê¸°ê°„ë§Œ ìˆ˜ì§‘
```python
# upbit_bitcoin_collector.pyì˜ collect_all_data ë©”ì„œë“œ ìˆ˜ì •
# 2019ë…„ ì²´í¬ ë¶€ë¶„ì„ ì›í•˜ëŠ” ë‚ ì§œë¡œ ë³€ê²½
```

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

### ë³´ê°„ ë°ì´í„° ì‹ë³„
```sql
-- ë³´ê°„ëœ ë°ì´í„°ë§Œ ì¡°íšŒ
SELECT * FROM bitcoin_minute5
WHERE is_interpolated = 1
ORDER BY timestamp DESC
LIMIT 10;

-- ë³´ê°„ ë¹„ìœ¨ í™•ì¸
SELECT
    COUNT(*) as total,
    SUM(CASE WHEN is_interpolated = 0 THEN 1 ELSE 0 END) as original,
    SUM(CASE WHEN is_interpolated = 1 THEN 1 ELSE 0 END) as interpolated,
    ROUND(SUM(CASE WHEN is_interpolated = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as interpolation_rate
FROM bitcoin_minute5;
```

### ê¸°ì¡´ ìˆ˜ì§‘ê¸° ì§ì ‘ ì‚¬ìš©
```bash
cd upbit_history_db
source venv/bin/activate
python upbit_bitcoin_collector.py
```

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Step 1: ê²€ì¦ ì‹¤í–‰ â†’ `data_gap_report.json` ìƒì„±
- [ ] Step 2: ë°ì´í„° ìˆ˜ì§‘ (ì•½ 1~2ì‹œê°„)
- [ ] Step 3: ì„ í˜•ë³´ê°„ ì²˜ë¦¬
- [ ] Step 4: ìµœì¢… ê²€ì¦ (ëª¨ë“  íƒ€ì„í”„ë ˆì„ 100%)
- [ ] DB ë°±ì—… ìƒì„±
- [ ] ë””ìŠ¤í¬ ìš©ëŸ‰ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-10-17
**ë²„ì „**: 1.0
**ì‘ì„±ì**: Claude (Automation Scripts)
