# 바이낸스 선물 헤지 설정 가이드

**작성일**: 2025-12-06
**목적**: v35 전략 + 바이낸스 숏 헤지로 하락장 대응

---

## 📋 필요한 정보

### 1. 바이낸스 API 키

#### API 키 발급 방법

1. **바이낸스 웹사이트 로그인**
   - https://www.binance.com

2. **API 키 생성**
   - 우측 상단 프로필 → API Management
   - "Create API" 클릭
   - API 이름 입력 (예: "Trading Bot")
   - 2FA 인증 완료

3. **API 권한 설정** ⚠️ **중요**
   - ✅ **Enable Spot & Margin Trading** (필수)
   - ✅ **Enable Futures** (필수)
   - ❌ **Enable Withdrawals** (보안상 비활성화 권장)
   - IP 제한 설정 (권장)

4. **API 키 저장**
   - **API Key**: `abcdef123456...`
   - **Secret Key**: `xyz789...` (절대 공개 금지!)

---

## 🔧 설정 방법

### 1. .env 파일에 추가

`.env` 파일을 열고 다음 내용 추가:

```bash
# 기존 업비트 설정
UPBIT_ACCESS_KEY=your_upbit_access_key
UPBIT_SECRET_KEY=your_upbit_secret_key
TELEGRAM_BOT_TOKEN=your_telegram_token
TELEGRAM_CHAT_ID=your_chat_id

# 🆕 바이낸스 설정 (추가)
BINANCE_API_KEY=your_binance_api_key
BINANCE_API_SECRET=your_binance_api_secret
```

**⚠️ 주의**: `.env` 파일은 절대 Git에 커밋하지 마세요!

---

### 2. 연결 테스트

```bash
cd live_trading
python binance_futures_trader.py
```

**예상 출력**:
```
======================================================================
  바이낸스 선물 트레이더 - 테스트
======================================================================
✅ 바이낸스 선물 연결 성공 (총 잔고: 100.00 USDT)
✅ BTCUSDT 레버리지 1배로 설정
✅ BTCUSDT 마진 타입: CROSSED

[계정 정보]
  총 잔고: 100.00 USDT
  사용 가능: 100.00 USDT
  미실현 손익: +0.00 USDT

[현재 포지션]
  없음

[현재 가격]
  BTC/USDT: 42,000.00 USDT

✅ 테스트 완료!
```

---

### 3. 듀얼 엔진 테스트

```bash
python dual_exchange_engine.py
```

**예상 출력**:
```
======================================================================
  듀얼 거래소 엔진 - 테스트
======================================================================
✅ 듀얼 모드: 업비트 롱 + 바이낸스 숏 헷지

[현재 상태]
  모드: hedge
  시장 상태: UNKNOWN

[업비트]
  포지션: 없음
  KRW 잔고: 1,000,000원
  BTC 잔고: 0.00000000 BTC
  총 가치: 1,000,000원

[바이낸스]
  포지션: 없음
  총 잔고: 100.00 USDT
  총 잔고: 130,000원

[합계]
  총 자산: 1,130,000원

✅ 테스트 완료!
```

---

## 💰 자금 요구사항

### 최소 자금

| 거래소 | 최소 금액 | 권장 금액 | 용도 |
|--------|----------|----------|------|
| **업비트** | 5,000원 | 1,000,000원 | 롱 포지션 (v35 전략) |
| **바이낸스** | 10 USDT | 100 USDT | 숏 헤지 (하락장 대응) |

### 자금 배분 예시

**총 자금 100만원 보유 시**:

#### 옵션 1: 보수적
- 업비트: 100만원 (100%)
- 바이낸스: 0 USDT (헤지 없음, 현금 전환 모드)

#### 옵션 2: 균형
- 업비트: 85만원 (85%)
- 바이낸스: 100 USDT (~13만원, 15%)

#### 옵션 3: 공격적
- 업비트: 70만원 (70%)
- 바이낸스: 200 USDT (~26만원, 30%)

**권장**: **옵션 2 (균형)** ⭐

---

## 🛡️ 헤지 전략 설명

### 듀얼 엔진 모드

#### 1. Cash 모드 (현금 전환)

```
BULL/SIDEWAYS: 업비트 롱 포지션
BEAR 감지:    업비트 즉시 청산 → 현금 보유
```

**장점**:
- ✅ 간단함
- ✅ 바이낸스 불필요
- ✅ 수수료 최소

**단점**:
- ⚠️ 하락장에서 수익 없음 (손실 방어만)

#### 2. Hedge 모드 (숏 헤지) ⭐ 권장

```
BULL/SIDEWAYS: 업비트 롱 포지션
BEAR 감지:    업비트 유지 + 바이낸스 숏 오픈 (50% 헤지)
BEAR 해제:    바이낸스 숏 청산
```

**장점**:
- ✅ 하락장에서도 수익 가능
- ✅ 업비트 포지션 유지 (장기 성장)
- ✅ 리스크 헤지

**단점**:
- ⚠️ 바이낸스 계정 필요
- ⚠️ 수수료 추가 (선물 거래)

### 헤지 비율 설정

**현재 기본값**: 50%

```python
# dual_exchange_engine.py:138
hedge_amount_krw = upbit_value * 0.5  # 50% 헤지
```

**조정 가능**:
- 보수적: 30% (0.3)
- 표준: 50% (0.5) ⭐ 권장
- 공격적: 70% (0.7)

---

## 🚀 실전 배포

### 단계별 배포 (권장)

#### Week 1: 소액 테스트

```bash
# Paper Trading (모의 거래)
cd live_trading
./deploy_v35_optimized.sh paper
```

**목적**: 시스템 안정성 확인

---

#### Week 2: 실전 30%

**자금**:
- 업비트: 30만원
- 바이낸스: 30 USDT (선택)

```bash
# 실거래 시작 (주의!)
./deploy_v35_optimized.sh live
```

**목표**:
- 7일간 모니터링
- 실제 vs 백테스팅 차이 확인
- 슬리피지, 수수료 검증

---

#### Week 3: 실전 100%

**자금**:
- 업비트: 100만원
- 바이낸스: 100 USDT

**조건**:
- Week 2 성과 확인 후
- 손실 없거나 백테스팅 범위 내
- 시스템 안정성 확인

---

## ⚠️ 리스크 관리

### 1. 레버리지

**현재 설정**: 1배 (안전)

```python
# binance_futures_trader.py:31
self.max_leverage = 1  # 안전하게 1배 고정
```

**절대 변경 금지**: 레버리지는 1배 유지 권장

### 2. 긴급 청산

```python
# 듀얼 엔진 긴급 청산
from dual_exchange_engine import DualExchangeEngine

engine = DualExchangeEngine(mode='hedge')
engine.emergency_close_all()
```

**텔레그램 명령어** (예정):
- `/emergency` - 긴급 전량 청산
- `/status` - 현재 포지션 확인

### 3. 손실 한도

**Stop Loss**: -2.1% (config_optimized.json)

**일일 손실 한도** (권장):
- 1일: -3%까지 허용
- 연속 2일 손실: 전략 재검토
- 1주일: -5%까지 허용

**월간 손실 한도**:
- -10% 돌파 시 즉시 중단

---

## 📊 모니터링

### 필수 지표

**일일 체크**:
- ✅ 포지션 상태 (업비트 + 바이낸스)
- ✅ 당일 손익
- ✅ 시장 상태 (BULL/BEAR/SIDEWAYS)

**주간 체크**:
- ✅ 주간 수익률 vs 백테스팅
- ✅ 거래 횟수
- ✅ 슬리피지 & 수수료 영향

**월간 체크**:
- ✅ 월간 수익률 (목표: +2~5%)
- ✅ Sharpe Ratio (목표: ≥1.5)
- ✅ MDD (목표: ≤5%)

### 텔레그램 알림

**자동 알림** (현재 구현):
- 🔔 매수/매도 시그널
- 📊 포지션 진입/청산
- ⚠️ Stop Loss 발동

**수동 명령어** (추가 예정):
- `/status` - 현재 상태
- `/report` - 일일 리포트
- `/monitor on/off` - 모니터링 활성화

---

## 🔧 트러블슈팅

### 1. 바이낸스 연결 실패

**에러**: `ConnectionError: 바이낸스 선물 연결 실패`

**해결**:
1. API 키 확인 (`.env` 파일)
2. API 권한 확인 (Futures 활성화)
3. IP 제한 확인 (현재 IP 허용)
4. VPN 사용 시 비활성화

### 2. 최소 주문 금액 에러

**에러**: `❌ 최소 주문 수량 미달`

**해결**:
- 바이낸스 최소 주문: 10 USDT
- 헤지 비율 조정 (50% → 70%)
- 또는 업비트 포지션 증가

### 3. 듀얼 엔진 모드 전환

**Cash → Hedge 전환**:

```python
# dual_exchange_engine.py 수정
engine = DualExchangeEngine(mode='hedge')  # 'cash' → 'hedge'
```

---

## 📁 관련 파일

### 코드
- `binance_futures_trader.py` - 바이낸스 선물 거래
- `dual_exchange_engine.py` - 듀얼 전략 엔진
- `upbit_trader.py` - 업비트 거래

### 설정
- `.env` - API 키 (절대 공개 금지!)
- `config_optimized.json` - v35 전략 설정

### 문서
- `BINANCE_SETUP_GUIDE.md` (이 파일)
- `251206-1135_COMPREHENSIVE_ANALYSIS_REPORT.md` - 백테스팅 분석

---

## ✅ 체크리스트

### 배포 전 필수 확인

- [ ] 바이낸스 API 키 발급
- [ ] `.env` 파일에 API 키 추가
- [ ] 바이낸스 연결 테스트 통과
- [ ] 듀얼 엔진 테스트 통과
- [ ] 최소 자금 확보 (업비트 5,000원 + 바이낸스 10 USDT)
- [ ] 레버리지 1배 확인
- [ ] 긴급 청산 방법 숙지
- [ ] 텔레그램 알림 설정

### 배포 후 필수 모니터링

- [ ] 첫 거래 시그널 확인
- [ ] 실제 체결가 vs 예상가 비교
- [ ] 수수료 & 슬리피지 확인
- [ ] 하루 1회 포지션 확인
- [ ] 주간 수익률 기록

---

## 🎯 예상 성과 (듀얼 전략)

### 시나리오 분석

**시나리오 A: 상승장 (2024 유사)**
- 업비트 롱: +40%
- 바이낸스 숏: 0% (미사용)
- **총 수익**: +40%

**시나리오 B: 하락장 (2022 유사)**
- 업비트 롱: -20% (손절 또는 현금 전환)
- 바이낸스 숏: +20% (50% 헤지 기준)
- **총 수익**: 약 0% (손실 방어)

**시나리오 C: 횡보장 (2025 유사)**
- 업비트 롱: +23%
- 바이낸스 숏: -5% (잦은 진입/청산)
- **총 수익**: +18~20%

**종합 기대값** (확률 가중):
- A (40%): +40%
- B (20%): 0%
- C (40%): +20%
- **기대 수익**: +24%/년

---

**작성일**: 2025-12-06
**작성자**: Claude Code
**버전**: v1.0

---

## 문의사항

설정 중 문제가 발생하면:
1. 에러 메시지 전체 복사
2. `.env` 파일 내용 (키 제외)
3. 실행 로그 파일

위 정보와 함께 문의하세요.
