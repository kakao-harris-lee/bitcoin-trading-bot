# v11 Multi-Entry Ensemble 전략 결과

**작성일**: 2025-10-19
**전략명**: Multi-Entry Ensemble (4-Way Entry)
**버전**: v11
**타임프레임**: DAY

---

## 📊 Executive Summary

**v11 전략**: v05 EMA Cross 기반 + 3가지 추가 진입 조건 (RSI Bounce, Breakout, Momentum)
**목표**: 350%+ (v05 대비 +56.62%p)
**결과**: **완전 실패** - 79.76% (v05 대비 -213.62%p)

---

## ❌ 최종 성과

### 2024년 백테스팅

```yaml
초기 자본: 10,000,000원
최종 자본: 17,976,106원
수익률: 79.76%

vs v05 (293.38%): -213.62%p ❌
vs Buy&Hold (137.90%): -58.13%p ❌
vs 목표 (350%): -270.24%p ❌

Sharpe Ratio: 1.45 (v05: 1.76, -0.31)
Max Drawdown: 38.23% (v05: 29.10%, +9.13%p)

총 거래: 4회 (v05와 동일)
승률: 50.0% (v05와 동일)
평균 수익: +52.32%
평균 손실: -10.88%
Profit Factor: 4.81
```

### 거래 내역

| 날짜 | 행동 | 가격 | 수익률 | 진입 이유 |
|------|------|------|--------|----------|
| 2024-02-16 | BUY | 60,258,000 | - | BREAKOUT |
| 2024-07-04 | SELL | 81,663,664 | +35.55% | Trailing Stop |
| 2024-07-13 | BUY | 91,164,882 | - | BREAKOUT |
| 2024-08-04 | SELL | 81,854,626 | -10.23% | Stop Loss |
| 2024-08-24 | BUY | 86,171,086 | - | MOMENTUM_SURGE |
| 2024-09-05 | SELL | 76,314,734 | -11.54% | Stop Loss |
| 2024-09-11 | BUY | 82,888,056 | - | BREAKOUT |
| 2024-12-29 | SELL | 139,707,053 | +69.09% | Final Exit |

---

## 🎯 목표 달성 여부

| 목표 | 목표값 | 달성값 | 평가 |
|------|--------|--------|------|
| 2024 수익률 >= 350% | ✅ | ❌ 79.76% (-270.24%p) | **FAIL** |
| v05 (293.38%) 초과 | ✅ | ❌ 79.76% (-213.62%p) | **FAIL** |
| Buy&Hold (137.90%) 초과 | ✅ | ❌ 79.76% (-58.13%p) | **FAIL** |
| Sharpe >= 2.0 | ✅ | ❌ 1.45 | **FAIL** |
| MDD <= 25% | ✅ | ❌ 38.23% | **FAIL** |

**종합 평가**: **F (전면 실패)** 😞

---

## 🔍 실패 원인 분석

### 1. Multi-Entry의 역설

**가설** (틀림):
- EMA Cross (v05) + RSI + Breakout + Momentum → 진입 기회 증가 → 수익 증가

**실제**:
- 진입 신호 67개 발견 → 실제 거래 4회 (v05와 동일)
- 추가 Entry 조건이 **더 나쁜 타이밍**에 진입

#### Entry 유형별 성과 비교

| Entry 유형 | 신호 빈도 | 실제 진입 | 평균 수익률 | 평가 |
|-----------|----------|-----------|-------------|------|
| EMA_GOLDEN_CROSS (v05) | 4회 | 0회 | N/A | ❌ 1번도 안 잡힘 |
| BREAKOUT (신규) | 17회 | 3회 | +31.14% | ⚠️ 손실 2회 |
| MOMENTUM_SURGE (신규) | 46회 | 1회 | -11.54% | ❌ 손실 |
| RSI_BOUNCE (신규) | 0회 | 0회 | N/A | ❌ 발동 안 됨 |

**핵심 문제**:
- **v05의 EMA Golden Cross가 전혀 선택되지 않음**
- BREAKOUT, MOMENTUM이 EMA보다 먼저 발동 → v05의 우수한 타이밍 놓침

### 2. Entry Priority 부재

**코드 구조**:
```python
if check_ema_cross():
    return 'buy'
if check_rsi_bounce():
    return 'buy'
if check_breakout():
    return 'buy'
if check_momentum():
    return 'buy'
```

**문제**:
- EMA 조건이 우선이지만, EMA Golden Cross는 연 4회만 발생
- 그 전에 Breakout/Momentum이 67회 발생하여 먼저 진입
- 결과: **v05의 검증된 타이밍을 전혀 활용 못 함**

### 3. 포지션 점유 문제

**시나리오**:
1. 2024-02-16: **BREAKOUT 신호** → 매수 (포지션 점유)
2. 2024-02-08: **EMA Golden Cross 발생** (역사적으로 v05 최고 진입점)
3. → **이미 포지션 보유 중** → EMA 진입 무시 ❌

**v05 성과**:
- 2024-02-08 EMA Golden Cross 진입 → +47.36% 수익 (v05 실제 거래)

**v11 성과**:
- 2024-02-16 Breakout 진입 → +35.55% 수익
- **차이**: -11.81%p 손실

### 4. Exit 전략 불일치

| 항목 | v05 | v11 (초기) | v11 (최종) |
|------|-----|----------|-----------|
| Trailing Stop | 21% (고정) | 10-25% (동적) | 21% (고정) |
| Stop Loss | 10% (고정) | 5-12% (동적) | 10% (고정) |

**시도한 개선**:
1. 초기: 시장 상황별 동적 파라미터 (10-25%)
2. → Bear 시장 50.9% 판단 → Trailing Stop 10% → 조기 청산
3. 최종: v05와 동일한 고정 21%

**결과**:
- 초기 (동적): 110.03%
- 최종 (고정): 79.76%
- → **악화됨** (동적이 더 나았음)

### 5. 잘못된 진입 타이밍

**v05 vs v11 진입 비교**:

| 날짜 | v05 진입 | v11 진입 | 결과 |
|------|----------|----------|------|
| 2024-02-03 | ✅ EMA Golden Cross | ❌ (2/16 Breakout 선택) | v05 +37.83%, v11 +35.55% |
| 2024-07-13 | ✅ EMA Golden Cross | ✅ Breakout | 둘 다 -5~11% 손실 |
| 2024-09-11 | ✅ EMA Golden Cross | ✅ Breakout | 둘 다 +66~80% 수익 |

**인사이트**:
- v05의 EMA Golden Cross는 **검증된 진입 타이밍**
- Breakout/Momentum은 **v05 타이밍보다 이르거나 늦음** → 성과 저하

---

## 💡 핵심 교훈

### 1. **단순함이 최고** (다시 한번 검증)

```
복잡한 전략 (v11) < 단순한 전략 (v05)
4가지 Entry 조건 < 1가지 EMA Cross
```

- v05: 단순 EMA Cross → 293.38%
- v07: MACD 추가 → 148.63% (오버피팅)
- v10 (RL): Multi-Agent → 0%
- v11: 4가지 Entry → 79.76%

**결론**: **전략 복잡도 ∝ 성능 저하**

### 2. **Entry 우선순위 필수**

**실패 사례**:
```python
# OR 조건: 먼저 발동되는 것 진입
if A or B or C or D:
    buy()
```

**개선 방향**:
```python
# Priority: A > B > C > D
if A:
    buy(reason='A')
elif B:
    buy(reason='B')
elif C:
    buy(reason='C')
elif D:
    buy(reason='D')
```

- **우선순위 없으면**: 저품질 신호가 고품질 신호 차단
- v11 실패 원인: Breakout(67회) > EMA Golden Cross(4회)

### 3. **검증된 전략 고수**

**v05 EMA Golden Cross**:
- 연 4회 진입
- 승률 50%
- 수익률 293.38%
- **검증됨**

**v11 추가 Entry**:
- Breakout: 평균 +31.14%, 손실 2회
- Momentum: 평균 -11.54%
- **미검증**

**교훈**: **검증된 전략을 버리지 말 것**

### 4. **테스트 조건의 중요성**

**v11 개발 과정**:
1. Entry 신호 테스트: 67개 발견 ✅
2. Regime Detector 테스트: 동작 확인 ✅
3. **실제 백테스팅**: 4회 거래, 79.76% ❌

**문제**:
- 개별 컴포넌트는 동작함
- **통합 시 상호작용 실패**

**해결책**:
- End-to-End 테스트 우선
- 개별 테스트만으로 검증 불가

### 5. **오버엔지니어링의 함정**

**v11 구현 내용**:
- 4가지 Entry Condition
- Market Regime Detector (4-Way)
- Adaptive Parameters (시장별)
- Multi-Indicator (EMA, RSI, MACD, ADX, Volume, Momentum)

**결과**:
- 코드 복잡도 ↑↑↑
- 성능 ↓↓↓
- 디버깅 어려움

**v05 구현**:
- 1가지 Entry (EMA Cross)
- 고정 Parameters
- 2개 Indicator (EMA12, EMA26)

**결과**:
- 코드 간단
- 성능 ↑↑↑
- 유지보수 쉬움

---

## 📊 비교표

### v05 vs v11

| 항목 | v05 (Simple) | v11 (Complex) | 승자 |
|------|--------------|---------------|------|
| **수익률 (2024)** | 293.38% | 79.76% | **v05** |
| **Sharpe Ratio** | 1.76 | 1.45 | **v05** |
| **Max Drawdown** | 29.10% | 38.23% | **v05** |
| **거래 횟수** | 4회 | 4회 | 동점 |
| **승률** | 50% | 50% | 동점 |
| **Entry 조건** | 1개 (EMA) | 4개 (EMA+RSI+Breakout+Momentum) | **v05** |
| **코드 복잡도** | ⭐ | ⭐⭐⭐⭐⭐ | **v05** |
| **유지보수성** | 쉬움 | 어려움 | **v05** |

**결론**: **v05 압승** (모든 지표에서 우수)

### 전략 계열 비교 (v05~v11)

| 버전 | 전략 | 2024 수익률 | 오버피팅 | 거래 | 평가 |
|------|------|------------|---------|------|------|
| v05 | Simple EMA | 293.38% | 57% | 4회 | ⭐⭐⭐⭐⭐ |
| v07 | EMA + MACD | 148.63% | 93% | 5회 | ⭐⭐☆☆☆ |
| v08 | Market Adaptive | 89.27% | - | 2회 | ⭐☆☆☆☆ |
| v09 | Longterm Optimized | 100.36% | 87% | - | ⭐⭐☆☆☆ |
| v10 | RL (PPO) | 0% | - | 0회 | ☆☆☆☆☆ |
| **v11** | **Multi-Entry** | **79.76%** | **N/A** | **4회** | **⭐☆☆☆☆** |

**패턴**: **버전 증가 ∝ 성능 저하**

---

## 🔧 다음 단계 제안

### ❌ 비추천: v12 Multi-Entry 개선

**이유**:
- v11 실패 원인: Entry 조건 자체가 v05보다 못함
- 추가 조건 개발은 시간 낭비
- "복잡도 증가 → 성능 저하" 패턴 반복될 가능성 높음

### ✅ 권장: v05 Parameter Tuning

**목표**: v05 (293.38%) → 350%+

**방법**:
1. **Optuna 재최적화**
   - 현재: position 0.98, trailing 21%, stop_loss 10%
   - 탐색: position 0.95-1.00, trailing 18-25%, stop_loss 8-12%
   - 목표: +56.62%p 개선

2. **Walk-Forward Validation**
   - 2018-2023 학습
   - 2024 월별 재최적화
   - 오버피팅 <40%

3. **다중 타임프레임** (보수적)
   - 기본: DAY (v05)
   - 보조: 4H (진입 타이밍 미세 조정)
   - 자본 배분: DAY 95%, 4H 5%

**예상 성과**: 320-350%

---

## 📁 파일 구조

```
strategies/v11_multi_entry_ensemble/
├── config.json                  # 설정 (Entry 조건, Regime Detection)
├── regime_detector.py           # 시장 상황 탐지기
├── strategy.py                  # 4-Way Entry 전략
├── backtest.py                  # 백테스팅 엔진
├── backtest_results_2024.json   # 결과 (79.76%)
└── result.md                    # 본 문서
```

---

## 📊 최종 평가

| 지표 | 목표 | 달성 | 평가 |
|------|------|------|------|
| 2024 수익률 >= 350% | ✅ | ❌ 79.76% | **FAIL** |
| v05 (293%) 초과 | ✅ | ❌ 79.76% | **FAIL** |
| Buy&Hold 초과 | ✅ | ❌ 79.76% | **FAIL** |
| Sharpe >= 2.0 | ✅ | ❌ 1.45 | **FAIL** |
| MDD <= 25% | ✅ | ❌ 38.23% | **FAIL** |

**종합 평가**: **F (전면 실패)** 😞

---

**작성자**: Claude
**작성일**: 2025-10-19
**다음 단계**: v05 Parameter Tuning (권장)
