# Phase 6: v36 Multi-Timeframe 백테스팅 보고서

**날짜**: 2025-10-19
**버전**: v36_multi_timeframe
**백테스팅 기간**: 2020-2025
**학습 기간**: 2020-2024 (기준)
**테스트 기간**: 2025 (Out-of-Sample)

---

## 📊 실행 요약

### v36 아키텍처
- **Day 타임프레임**: v35_optimized (자본 40%)
- **Minute240 타임프레임**: 스윙 트레이딩 (자본 30%)
- **Minute60 타임프레임**: 스캘핑 (자본 30%)
- **통합 관리**: EnsembleManager (시그널 우선순위, Day 필터 전파)

### 백테스팅 결과 (기본 설정)

| Year | Total Return | Buy&Hold | Excess | Sharpe | MDD | Trades |
|------|-------------|----------|--------|--------|-----|--------|
| 2020 | **+12.27%** | +195.81% | -183.53%p | **2.20** | -2.52% | 12 |
| 2021 | **+14.30%** | +57.11% | -42.80%p | **1.90** | -4.81% | 18 |
| 2022 | **-7.20%** | -55.42% | +48.22%p | -1.20 | -8.60% | 16 |
| 2023 | **+5.46%** | +94.88% | -89.42%p | **1.17** | -1.97% | 17 |
| 2024 | **+10.36%** | +134.76% | -124.39%p | **1.87** | -3.12% | 13 |
| **2025** | **+5.68%** | +8.44% | -2.76%p | **2.23** | **-1.00%** | 8 |

---

## ⚠️ 핵심 이슈: M240/M60 전략 미작동

### 문제 진단
**타임프레임별 실제 성과**:
- **Day**: 제대로 작동 (2025년 +14.20%, 8 trades)
- **Minute240**: **0 trades** (전혀 작동 안 함)
- **Minute60**: **0 trades** (전혀 작동 안 함)

### 원인 분석

#### 1. M240 진입 조건이 너무 엄격
```python
# 현재 M240 Entry 조건:
- Day 필터: BULL_STRONG or BULL_MODERATE or SIDEWAYS_UP
- MACD 골든크로스
- RSI > 50
```

**문제**:
- 2020-2025 전 기간에 걸쳐 이 3가지 조건이 **동시에 만족되는 경우가 거의 없음**
- 특히 Minute240에서 MACD 골든크로스는 드물게 발생 (Day 데이터보다 훨씬 적음)

#### 2. M60 진입 조건도 마찬가지
```python
# 현재 M60 Entry 조건:
- Day 필터: NOT (BEAR_STRONG or BEAR_MODERATE)
- RSI < 30 (과매도)
- MACD 골든크로스
```

**문제**:
- RSI < 30 조건은 급락 시에만 발생 (연간 10-20회 정도)
- MACD 골든크로스와 동시 만족 확률은 더욱 낮음

### 결과
- v36은 **사실상 Day만 40% 자본으로 거래하는 전략**으로 작동
- M240/M60의 30%씩 자본은 전혀 사용되지 않음
- **2025년 총 수익률 +5.68%**는 Day의 +14.20%를 40%만 사용한 결과 (14.20 × 0.4 = 5.68)

---

## 💡 해결책

### Option 1: Optuna 하이퍼파라미터 최적화 (권장 ⭐)
**목표**: M240/M60 진입 조건을 2020-2024 데이터 기반으로 최적화

**최적화 대상**:
- M240 RSI threshold: 50 → 45-60 range
- M240 MACD 조건 완화 (골든크로스 외 추가 조건)
- M60 RSI oversold: 30 → 25-40 range
- M60 RSI overbought: 70 → 60-75 range
- 자본 배분 비율: Day/M240/M60 = 40/30/30 → 최적 비율 탐색

**예상 소요 시간**: 1-2시간 (200 trials)

**실행 방법**:
```bash
cd strategies/v36_multi_timeframe
python optimize.py  # 2020-2024 학습 → 2025 검증
```

### Option 2: M240/M60 진입 조건 수동 완화
**빠른 검증용** (5분 소요):
- M240 RSI threshold: 50 → 45 (완화)
- M60 RSI oversold: 30 → 35 (완화)
- MACD 조건 제거하고 RSI + Volume으로 대체

### Option 3: v35 단독 사용 (현재 최선)
- v36 포기하고 v35_optimized (Day 전략) 100% 자본 사용
- **2025년 +14.20%** 달성 (목표 +15%의 94.7%)

---

## 📈 v34/v35/v36 비교 (2025년 기준)

| 전략 | 2025 Return | Sharpe | MDD | Trades | 비고 |
|------|-------------|--------|-----|--------|------|
| **v34_supreme** | +8.43% | 1.34 | -2.83% | 20 | Phase 4 Base |
| **v35_optimized** | +14.20% | **2.24** | **-2.33%** | 8 | Phase 5 (동적 익절 + SIDEWAYS 강화) ⭐ |
| **v36_multi_timeframe** | +5.68% | 2.23 | -1.00% | 8 | Phase 6 (M240/M60 미작동) ❌ |

**결론**:
- **v35가 현재 최고 성과** (+14.20%)
- v36은 M240/M60 최적화 전까지는 v35보다 성과가 낮음

---

## 🔍 타임프레임별 상세 분석

### Day (v35) - 2025년
- **사용 자본**: 40% (4,000,000원)
- **최종 자본**: 4,568,000원
- **수익률**: +14.20%
- **거래**: 8회
- **승률**: 25%
- **기여도**: 총 수익의 100% (M240/M60이 0이므로)

### Minute240 - 2025년
- **사용 자본**: 30% (3,000,000원)
- **최종 자본**: 3,000,000원 (변동 없음)
- **수익률**: 0%
- **거래**: 0회
- **상태**: **미작동**

**원인**:
- Day 필터 통과 빈도: ~60% (BULL/SIDEWAYS_UP)
- 필터 통과 시에도 MACD 골든크로스 + RSI>50 조건 충족 빈도: **~0%**

### Minute60 - 2025년
- **사용 자본**: 30% (3,000,000원)
- **최종 자본**: 3,000,000원 (변동 없음)
- **수익률**: 0%
- **거래**: 0회
- **상태**: **미작동**

**원인**:
- Day 필터 통과 빈도: ~80% (BEAR 제외)
- 필터 통과 시에도 RSI<30 + MACD 골든크로스 조건 충족 빈도: **~0%**

---

## 🛠️ 다음 단계 권장사항

### 즉시 실행 가능
1. **v35 프로덕션 배포** - 현재 최고 성과 (+14.20%, Sharpe 2.24)
2. **v36 Optuna 최적화** - M240/M60 활성화 (예상 2시간)

### 중기 계획
3. **v36 최적화 후 재백테스팅** - 목표: 2025년 +20% 이상
4. **최적 전략 선정** - v35 vs v36_optimized 비교

### 장기 계획
5. **강화학습 적용** (Phase 7) - PPO/A3C로 동적 전략
6. **앙상블 전략** - v35 + v36 조합

---

## 📁 생성된 파일

### 코드
- `strategies/v36_multi_timeframe/backtest.py` - 멀티 타임프레임 백테스팅 엔진
- `strategies/v36_multi_timeframe/optimize.py` - Optuna 최적화 스크립트 (200 trials)
- `strategies/v36_multi_timeframe/ensemble_manager.py` - 시그널 통합 관리자
- `strategies/v36_multi_timeframe/strategies/minute240_strategy.py` - 스윙 트레이딩
- `strategies/v36_multi_timeframe/strategies/minute60_strategy.py` - 스캘핑

### 데이터
- `strategies/v36_multi_timeframe/backtest_results.json` - 2020-2025 전체 결과
- `strategies/v36_multi_timeframe/config.json` - 기본 설정

### 문서
- `strategies/v36_PHASE6_REPORT.md` - 이 파일

---

## 🎯 최종 결론

### 성공 요소
✅ v36 프레임워크 완성 (EnsembleManager, 3개 타임프레임 통합)
✅ Day 전략 안정적 작동 (v35 기반)
✅ Sharpe Ratio 유지 (2.23)
✅ MDD 개선 (-1.00%, v35 -2.33% 대비)

### 실패 요소
❌ M240/M60 전략 미작동 (0 trades)
❌ 2025년 수익률 +5.68% (v35 +14.20% 대비 하락)
❌ 목표 +25-30% 미달성 (현재 22.6% 부족)

### 핵심 문제
**진입 조건이 너무 엄격**하여 M240/M60에서 단 한 번의 거래도 발생하지 않음.
→ **Optuna 최적화 필수**

### 권장 조치
1. **단기**: v35_optimized를 프로덕션으로 사용 (+14.20%)
2. **중기**: v36 Optuna 최적화 실행 (2시간)
3. **검증**: 최적화 후 v36 vs v35 비교 후 최종 선택

---

**작성자**: Claude (Orchestrator)
**날짜**: 2025-10-19 18:30
