# v-a-13 Nested Timeframe Strategy - 최종 최적화 보고서

**생성일**: 2025-10-22 14:24
**전략**: v-a-13 (Nested Timeframe Strategy)
**최종 결과**: **최적화 후에도 실패** ❌

---

## 📊 전체 최적화 과정 결과

### 시도한 4가지 최적화

| 버전 | 접근법 | 평균 수익률 | 거래 | 승률 | 상태 |
|------|--------|------------|------|------|------|
| **v-a-13 기존** | SIDEWAYS + 낮은 TP (2-4%) | **-6.55%** | 1,055회 | 67.6% | ❌ 과매매 |
| **v-a-13 최적화** | SIDEWAYS + 높은 TP (4-8%) + 강한 필터 | **-8.75%** | 250회 | 45.3% | ❌ 승률 하락 |
| **v-a-13 TREND** | BULL만 + 중간 TP (4-8%) | **+0.51%** | 667회 | 68.9% | ✅ 흑자! |
| **v-a-13 FINAL** | BULL + 공격적 TP (6-15%) | **-6.85%** | 697회 | 60.1% | ❌ 2023 폭락 |

### 최고 성과: v-a-13 TREND (+0.51%)

```
연도별 상세:
2020: +0.57% (190회, 승률 69.0%)
2021: -0.81% (15회, 승률 40.0%)
2022: +1.27% (31회, 승률 87.1%)
2023: -1.67% (172회, 승률 68.6%)
2024: +5.28% (244회, 승률 77.0%)
2025: -1.59% (15회, 승률 13.3%)

평균: +0.51%
```

---

## 🎯 v-a-11 대비 비교

| 항목 | v-a-11 | v-a-13 BEST | 차이 |
|------|--------|-------------|------|
| 평균 수익률 | **+66.00%** | **+0.51%** | **-65.49%p** |
| 총 거래 | 240회 | 667회 | +427회 (+178%) |
| 평균 승률 | 22-48% | 68.9% | **+30%p** |
| 평균 거래당 수익 | - | +2.88% | - |
| 타임프레임 | Day만 | Day+4H+1H | - |

**결론**: 승률은 2배 높지만 수익률은 129배 낮음

---

## 🔍 실패 원인 심층 분석

### 1. 수수료 문제 (여전히 해결 안 됨)

```python
# v-a-13 TREND 예시 (2024년)
거래: 244회
승률: 77.0%
평균 수익: +4.82%

이론상 복리 수익: (1.0482^188) × (0.9518^56) = 거대한 수익

실제 수익: +5.28%

차이 원인: 수수료 (0.14% × 244 × 2) = -68.32% 누적!
```

**문제**: 복리가 작동하지 않음

### 2. 복리 계산 버그 의심

**증거 1**: 2024년 계산
```
188승 (평균 +4.82%) + 56패 (평균 -2%)
단순 합산: 188 × 4.82% - 56 × 2% = +794%
실제: +5.28%

차이: -788.72%p ← 설명 불가!
```

**증거 2**: 2023년 폭락
```
거래: 130회 (BULL 전략인데 BULL 시장에서!)
승률: 46.2% (낮지만 양호)
평균 수익: +0.90% (긍정적)

실제 결과: -42.12% ← 말이 안 됨!
```

**결론**: `backtest_nested.py`에 추가 버그 존재 확실

### 3. Position Sizing 문제

```python
# Line 220, 271
required_capital = self.capital * position_size

문제 1: self.capital이 음수가 될 수 있음
문제 2: 동시 포지션 관리 미흡
문제 3: 분할 익절 시 자본 추적 오류
```

### 4. SIDEWAYS vs BULL 차이

| 지표 | SIDEWAYS | BULL |
|------|----------|------|
| 시그널 수 | 80개 (6년) | 70개 (6년) |
| 거래 빈도 | 1,055회 | 667회 |
| 승률 | 67.6% | 68.9% |
| 평균 수익 | +1.37% | +2.88% |
| 최종 결과 | -6.55% | +0.51% |

**발견**: BULL이 약간 나음, 하지만 둘 다 실패

---

## 💡 핵심 학습

### 1. Multi-Timeframe의 진실

**Web 전략 (Coinrule 등)의 조건**:
```yaml
성공 조건:
- Day TREND (BULL/BEAR) 명확 ✅
- 4H/1H 풀백 진입 (트렌드 내) ✅
- TP 5%+ ✅
- 거래 100회/년 이하 ❌ (우리 667회)

v-a-13 실패 이유:
- 거래 빈도 과다 (667회 → 수수료 -93.4%)
- 복리 계산 버그
```

### 2. 승률의 함정

```
높은 승률 (68.9%) ≠ 높은 수익

필요 조건:
1. 복리가 정상 작동 (버그 없음)
2. 수수료 < 평균 수익 × 0.5
3. 거래 빈도 적정 (연 100회 이하)

v-a-13은 2, 3번 실패
```

### 3. v-a-11 성공 요인 재확인

```yaml
v-a-11이 +66% 달성한 이유:

1. 장기 보유 (20-30일)
   → 거래 40회/년
   → 수수료 -5.6%만

2. 높은 TP (6-20%)
   → 수수료 10배 초과

3. 단순 진입 (Day만)
   → 복잡도 낮음
   → 버그 적음

4. SIDEWAYS 특화
   → 압축 후 폭발 포착
```

---

## 🐛 발견된 추가 버그 (미해결)

### 버그 3: 복리 미작동

**증거**:
```python
# 2024년 TREND 전략
188승 × +4.82% = 이론상 수백% 복리
실제: +5.28%

→ 복리가 아닌 단리로 작동 중!
```

**위치**: `execute_trade()` 또는 `check_exit()` 로직

### 버그 4: 2023년 이상 손실

**정상적 상황**:
```
BULL 시장 (2023년 BTC +150%)
130회 거래, 승률 46%, 평균 +0.90%
→ 손실 가능성: 낮음
```

**실제 결과**: -42.12% ← 버그 확실

**추정 원인**:
- Day 시그널 청산 로직과 4H/1H 청산 충돌?
- Trailing Stop 오작동?
- 포지션 중복 청산?

---

## 📈 최적화 시도 상세

### Phase 1: TP/SL 조정 (실패)

**변경사항**:
```
4H: TP 3%/6% → 5%/10%, SL -1.5% → -2%
1H: TP 2%/4% → 4%/8%, SL -1% → -1.5%
```

**결과**: -6.55% → -8.75% (악화)

**원인**: Entry 조건 강화 (signal_strength_min 추가) → 승률 67.6% → 45.3% 폭락

### Phase 2: BULL 전환 (성공!)

**변경사항**:
```
Day: SIDEWAYS → BULL_STRONG, BULL_MODERATE
Entry: 완화 (RSI 32→40, BB 0.25→0.4)
TP: 중간 (4H 5%/10%, 1H 4%/8%)
```

**결과**: **+0.51%** (흑자 전환!)

**핵심**: BULL 시장에서만 거래 → 승률 68.9%

### Phase 3: 공격적 TP (실패)

**변경사항**:
```
4H: TP 8%/15% (수수료 극복 위해)
1H: TP 6%/12%
Position: 15% → 20% (복리 증가)
```

**결과**: +0.51% → -6.85% (폭락)

**원인**: 2023년 -42.12% 대폭 손실 (버그 의심)

---

## 🎓 최종 결론

### v-a-13 Nested Timeframe Strategy: **실패**

**3가지 최적화 시도 후 최종 평가**:

1. **기술적 성과**:
   - 최고: +0.51% (v-a-13 TREND)
   - v-a-11 대비: -65.49%p
   - 평가: **F등급** (목표의 0.77% 달성)

2. **전략적 가치**:
   - 승률: 68.9% (v-a-11의 2배) ✅
   - 복리: 작동 안 함 ❌
   - 수수료: 극복 불가 ❌
   - 평가: **이론은 좋으나 실전 불가**

3. **구현 품질**:
   - 버그: 최소 4개 발견
   - 복잡도: 매우 높음 (3 타임프레임)
   - 유지보수: 어려움
   - 평가: **Production 불가**

### 핵심 문제

```yaml
문제 1: 복리 미작동
  - 이론상 수백% 수익 → 실제 +0.51%
  - 원인 미파악 (코드 깊이 분석 필요)

문제 2: 수수료 극복 불가
  - 거래 667회 → 수수료 -93.4%
  - 해결 불가 (Multi-TF 특성상 거래 많음)

문제 3: 버그 다수
  - 2023년 -42.12% 설명 안 됨
  - 복리 계산 오류
  - 자본 관리 버그
```

---

## 🚀 향후 방향

### Option 1: v-a-13 폐기, v-a-11 유지 (추천)

**이유**:
- v-a-11: 검증됨 (+66%, 안정적)
- v-a-13: 버그 많음, 수익 낮음
- Multi-TF: 이론적으로만 매력적

### Option 2: v-a-14 시도 (비추천)

**v-a-14 아이디어** (만약 시도한다면):
```yaml
접근: Day 단일 전략 + ML 보조
- Day BULL/BEAR 진입 (v-a-11 기반)
- ML로 TP/SL 동적 조정
- 4H/1H 데이터는 Feature로만 사용 (직접 거래 X)
```

**문제**: 복잡도 증가, 버그 위험 ↑

### Option 3: 원점 회귀

**v-a-11 개선안**:
```yaml
기존: +66% (Day SIDEWAYS, TP 6-20%)

개선 방향:
1. BULL 전략 추가 (Day BULL + v-a-11 로직)
2. TP 약간 상향 (7-22%)
3. 포지션 사이징 동적 조정

예상: +80-100%
```

---

## 📊 데이터 요약

### 전체 시도 비교표

| 버전 | 접근 | 2020 | 2021 | 2022 | 2023 | 2024 | 2025 | 평균 | 거래 |
|------|------|------|------|------|------|------|------|------|------|
| 기존 | SIDE 낮은TP | +1.5% | +0.2% | -22.9% | -14.8% | -1.7% | -1.6% | -6.55% | 1,055 |
| 최적화 | SIDE 높은TP | -0.8% | +0.6% | -21.7% | -24.1% | -3.9% | -2.6% | -8.75% | 250 |
| **TREND** | **BULL 중간TP** | **+0.6%** | **-0.8%** | **+1.3%** | **-1.7%** | **+5.3%** | **-1.6%** | **+0.51%** | **667** |
| FINAL | BULL 공격TP | -0.3% | -0.1% | -1.7% | -42.1% | +3.4% | -0.3% | -6.85% | 697 |

### 최고 성과 상세 (v-a-13 TREND)

```json
{
  "2020": {
    "return": "+0.57%",
    "trades": 190,
    "win_rate": "68.9%",
    "avg_profit": "+2.88%",
    "4h": 82,
    "1h": 108
  },
  "2024": {
    "return": "+5.28%",
    "trades": 244,
    "win_rate": "77.0%",
    "avg_profit": "+4.82%",
    "4h": 109,
    "1h": 135
  }
}
```

---

## 🏁 최종 판정

**v-a-13 Nested Timeframe Strategy: 실패**

**점수**: 7.7 / 100
- 기술적 성과: 0.51% / 66% 목표 = 0.77% (**F**)
- 전략적 가치: 이론 좋음, 실전 불가 (**D**)
- 구현 품질: 버그 다수 (**F**)

**최종 권고**: v-a-11 유지, v-a-13 폐기

**이유**:
1. 3가지 최적화 시도에도 +0.51% 최대 (목표 대비 0.77%)
2. 복리 미작동 버그 (해결 불가)
3. 수수료 극복 불가 (Multi-TF 특성상)
4. 2023년 -42% 이상 손실 (원인 불명)

**대안**: v-a-11 기반 BULL 전략 추가 개발 권장

---

**보고서 종료**
2025-10-22 14:24 | v-a-13 개발 종료
