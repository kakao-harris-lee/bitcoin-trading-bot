# v19-v20 종합 분석 및 프로젝트 결론

**작성일**: 2025-10-19
**분석 대상**: v19 (Market-Adaptive), v20 (Simplified Adaptive)
**분석 기간**: 2022-2025 (4년)

---

## 📊 Executive Summary

### 목표

**4년 백테스팅 규칙 검증** (2022-2024 학습, 2025 Out-of-Sample)
- **목표**: 4년 평균 수익률 >= 79.75% (Buy&Hold 64.75% + 15%p)
- **Buy&Hold 기준선**:
  - 2022: -63.62% (하락장)
  - 2023: +168.14% (극단적 상승장)
  - 2024: +134.35% (지속 상승장)
  - 2025: +20.14% (횡보장)
  - 4년 평균: 64.75%

### 결과

| 전략 | 2022 | 2023 | 2024 | 2025 | 평균 | 목표 | 판정 |
|------|------|------|------|------|------|------|------|
| v19 | -2.49% | -2.12% | +1.77% | +4.78% | **0.48%** | 79.75% | ❌ -79.27%p |
| v20 | -18.74% | +3.34% | +10.35% | +12.38% | **1.83%** | 79.75% | ❌ -77.92%p |
| BH | -63.62% | +168.14% | +134.35% | +20.14% | **64.75%** | - | - |

**최종 판정**: ❌ **모든 전략 목표 미달**

---

## 🔍 전략별 상세 분석

### v19: Market-Adaptive Hybrid

**컨셉**: 시장 상황(하락/상승/횡보)을 ADX + 20일 수익률로 분류, 상황별 최적 전략 적용

#### 설계

```yaml
시장_분류:
  상승장: ADX >= 25 AND 20d수익률 >= +15%
    전략: VWAP Breakout, 익절 +30%, 포지션 90%

  하락장: ADX >= 25 AND 20d수익률 <= -10%
    전략: RSI < 20 반등, 익절 +5%, 포지션 30%

  횡보장: 그 외
    전략: RSI 30/70 역추세, 익절 +10%, 포지션 60%
```

#### 실패 원인

1. **시장 분류 실패**
   - 2023-2024년 대부분 기간이 "상승장" 조건 미충족
   - 횡보장으로 잘못 분류 → RSI 전략만 작동
   - 진입 기회 거의 없음 (연 1~2회)

2. **VWAP 전략 미작동**
   - 상승장으로 분류되지 않아 실행 자체가 안됨
   - 2023년 +168% 상승장을 완전히 놓침

3. **거래 통계**
   - 연평균 1.8회 (극단적으로 낮음)
   - 자본 활용도 거의 없음

#### 연도별 상세

**2022년**: -2.49% (4거래, 25% 승률)
- 하락장 방어 실패 (BH -63% 대비 방어력 부족)
- 시장 전환 빈번 → 손절 반복

**2023년**: -2.12% (1거래, 0% 승률)
- **치명적**: BH +168% 상승장 완전 놓침
- 8월 단 1회 거래 (-3.54%)

**2024년**: +1.77% (1거래, 100% 승률)
- **치명적**: BH +134% 상승장 놓침
- 8월 단 1회 거래 (+2.95%)

**2025년**: +4.78% (1거래, 100% 승률)
- 방어적 전략 성공 (BH +20% 대비 경쟁력 있음)
- 2월 반등 포착 (+15.92%)

---

### v20: Simplified Adaptive

**컨셉**: VWAP Breakout 단일 전략 + 20일 수익률 기반 동적 포지션 사이징

#### 설계

```yaml
매수_전략:
  VWAP 돌파 (v17과 동일)

포지션_크기:
  20d수익률 < -5%: 30% (DEFENSIVE)
  20d수익률 > +15%: 90% (AGGRESSIVE)
  중간: 60% (NEUTRAL)

익절/손절:
  DEFENSIVE: +10% / -5%
  NEUTRAL: +20% / -7%
  AGGRESSIVE: +35% / -10%
```

#### 개선점 (vs v19)

1. **전략 단순화**: 복잡한 시장 분류 제거
2. **VWAP 기본 적용**: 모든 시장에서 VWAP Breakout 작동
3. **거래 빈도 증가**: 연평균 2.8회 (v19의 1.8회 대비)

#### 여전한 문제

1. **2022년 하락장**: -18.74% (BH -63% 대비 방어력 부족)
   - 4회 연속 손절 (평균 -8.4%)
   - VWAP Breakout 자체가 하락장에 부적합

2. **2023-2024년 상승장**: +3.34%, +10.35%
   - **치명적**: BH +168%, +134% 대비 압도적 열세
   - 조기 익절 (+20%) 후 추가 상승(+100%) 놓침

3. **거래 빈도 여전히 낮음**
   - 2023년 1회, 2025년 1회
   - 복리 효과 없음

#### 연도별 상세

**2022년**: -18.74% (4거래, 0% 승률)
- 모든 거래 손절 (-7~-10%)
- NEUTRAL 모드 지속 (20d수익률이 -5% 미만으로 떨어지지 않음)

**2023년**: +3.34% (1거래, 100% 승률)
- 3월 DEFENSIVE 진입 → +10% 익절
- 이후 추가 상승 (+400%) 완전 놓침

**2024년**: +10.35% (5거래, 40% 승률)
- 2승 3패 (익절 +20% × 2, 손절 -8% × 3)
- 여전히 BH +134% 대비 압도적 열세

**2025년**: +12.38% (1거래, 100% 승률)
- 5월 NEUTRAL 진입 → 8월 +20% 익절
- BH +20% 대비 경쟁력 있음

---

## 💡 핵심 발견 및 교훈

### 1. 극단적 상승장에서 Buy&Hold를 이기는 것은 불가능

**구조적 문제**:
```
능동 거래 전략의 특징:
  - 익절 목표: +10~35%
  - 손절 설정: -5~-10%
  - 보유 기간: 수일~수주

Buy&Hold (2023년):
  - 수익률: +168%
  - 보유 기간: 365일

→ 능동 거래가 구조적으로 불리
```

**2023년 시뮬레이션**:
- v20이 3월 진입 → +10% 익절 (3월 14일)
- 이후 비트코인은 추가로 +140% 상승 (12월까지)
- **능동 거래의 근본적 한계**

### 2. VWAP Breakout의 한계

**문제**:
1. **진입 시점 늦음**
   - 상승 초기 (1~2월)에는 VWAP 돌파 신호 없음
   - 3~5월 중반에야 진입 → 이미 +30~50% 상승 후

2. **조기 익절**
   - Trailing Stop 20% 또는 익절 +20~35%
   - 대부분 1~2개월 내 청산
   - 추가 상승(+50~100%) 놓침

3. **하락장 무방비**
   - VWAP 돌파 신호는 하락장에서도 발생
   - 2022년 4회 연속 손절 (-7~-10%)

### 3. 거래 빈도 문제

**현실**:
- v19: 연 1.8회
- v20: 연 2.8회

**필요**:
- 월 2~4회 (연 24~48회)
- 복리 효과 발생
- 소폭 수익 누적

**원인**:
- Day 타임프레임 사용 (진입 기회 제한적)
- VWAP Breakout 자체가 보수적 신호

### 4. 시장 적응형 전략의 함정

**v19의 교훈**:
- 시장 분류 조건이 너무 엄격 → 대부분 "횡보장"으로 분류
- 복잡한 로직 → 디버깅 어려움, 오버피팅 위험

**v20의 개선**:
- 단순화 → 이해 용이, 디버깅 쉬움
- 하지만 **여전히 목표 미달**

---

## 🎯 향후 방향

### 현실적 평가

**현재 목표 (비현실적)**:
- 4년 평균 79.75% (Buy&Hold 64.75% + 15%p)

**문제**:
- 2023-2024년 극단적 상승장(+168%, +134%)
- 능동 거래로 이 수익률을 능가하는 것은 **구조적으로 불가능**

### 접근 방식 재설정

#### 옵션 1: **목표 재설정** (추천)

**새 목표**:
```yaml
상승장(BH >= +100%):
  목표: BH - 50%p ~ BH - 20%p
  이유: 조기 익절 불가피, 방어에 집중
  예: BH +168% → 전략 목표 +118~148%

일반장(BH 20~100%):
  목표: BH + 10~20%p
  이유: 능동 거래의 가치 발휘 가능

하락장(BH < 0%):
  목표: BH + 30~50%p 또는 절대 손실 -20% 이내
  이유: 손실 방어가 핵심 가치

4년_종합:
  목표: 상황별 목표의 평균 달성
```

**v20 재평가**:
- 2022: -18.74% vs BH -63.62% → ✅ +44.88%p 방어 (목표 +30%p 대비 초과)
- 2023: +3.34% vs BH +168.14% → ❌ 목표 +118~148% 미달
- 2024: +10.35% vs BH +134.35% → ❌ 목표 +84~114% 미달
- 2025: +12.38% vs BH +20.14% → ❌ 목표 +30~40% 근접

**결론**: 여전히 미달하지만, 기존 목표(+15%p)보다 현실적

#### 옵션 2: **혼합 전략** (Buy&Hold + 능동 거래)

```yaml
자본_배분:
  Buy&Hold: 50% (상승장 대비)
  능동_거래: 50% (하락장 방어 + 소폭 수익)

예상_성과:
  2022: (50% × -63.62%) + (50% × -18.74%) = -41.18% (vs BH -63.62%, +22.44%p)
  2023: (50% × +168.14%) + (50% × +3.34%) = +85.74% (vs BH +168.14%, -82.4%p)
  2024: (50% × +134.35%) + (50% × +10.35%) = +72.35% (vs BH +134.35%, -62%p)
  2025: (50% × +20.14%) + (50% × +12.38%) = +16.26% (vs BH +20.14%, -3.88%p)

  4년_평균: 33.29% (vs BH 64.75%, -31.46%p)
```

**평가**: 여전히 BH보다 낮음

#### 옵션 3: **장기 보유 전략** (Trend Following)

**컨셉**:
- 상승장 감지 시 3~6개월 보유 (익절 목표 +100~200%)
- 하락장 감지 시 즉시 청산
- Trailing Stop 확대 (20% → 40%)

**문제**:
- 상승/하락장 전환 시점 예측 불가
- False Signal 빈번 → 손절 반복

#### 옵션 4: **타임프레임 변경** (minute60 → minute240)

**기대**:
- 거래 빈도 증가 (연 10~20회)
- 소폭 수익 누적

**문제**:
- 데이터 분석 결과 minute240도 day와 유사한 성과
- 근본적 해결책 아님

---

## 📋 최종 결론

### 4년 백테스팅 규칙 검증 결과

**v17 (이전 분석)**:
- 2024년: +140.75%
- 4년 평균: 49.62% (목표 93.38% 미달)
- 판정: ❌ 오버피팅

**v19**:
- 4년 평균: 0.48% (목표 79.75% 미달)
- 판정: ❌ 시장 분류 실패

**v20**:
- 4년 평균: 1.83% (목표 79.75% 미달)
- 판정: ❌ 상승장 대응 실패

### 프로젝트 학습 내용

1. **능동 거래의 한계**
   - 극단적 상승장(+100% 이상)에서 Buy&Hold를 능가하는 것은 구조적으로 불가능
   - 조기 익절/손절 메커니즘이 장기 추세에 불리

2. **4년 백테스팅의 가치**
   - 단일 연도(2024년) 성과는 오버피팅 위험
   - v17의 2024년 +140% → 4년 평균 49% 붕괴 확인

3. **Out-of-Sample 검증의 중요성**
   - v19, v20 모두 2025년 검증 통과
   - 하지만 절대 수익률이 너무 낮음 (목표 미달)

4. **시장 적응형 전략의 어려움**
   - 시장 분류 자체가 후행 지표 (ADX, 20일 수익률)
   - 분류 조건 엄격 → 진입 기회 부족
   - 분류 조건 완화 → 오분류 증가

### 권장 사항

**프로젝트 방향 전환**:

1. **목표 재설정**
   - 현재: "Buy&Hold + 15%p"
   - 새 목표: "상황별 차등 목표" (상승장 손실 인정)

2. **전략 재설계**
   - 단순 Buy&Hold vs 능동 거래 비교 중단
   - 대안:
     - **하락장 방어 전략**: 손실 -20% 이내 제한
     - **혼합 전략**: 50% Buy&Hold + 50% 능동 거래
     - **인덱스 펀드 모방**: 비트코인 +  알트코인 포트폴리오

3. **다른 접근 탐색**
   - 강화학습 (DQN, PPO)
   - 포트폴리오 최적화
   - 시장 중립 전략 (Long/Short)

4. **실시간 거래 유보**
   - 백테스팅에서 목표 달성 전까지 실시간 거래 금지
   - 추가 전략 개발 및 검증 필요

---

## 📂 생성된 파일

### 전략 파일
- `/strategies/v19_market_adaptive_hybrid/`
  - strategy.py
  - config.json
  - backtest.py
  - result_2022~2025.json
  - multi_year_analysis.md

- `/strategies/v20_simplified_adaptive/`
  - strategy.py
  - config.json
  - backtest.py
  - result_2022~2025.json
  - multi_year_analysis.md

### 계획 및 분석 문서
- `/strategies/_plans/251019_v19_market_adaptive_hybrid.plan.md`
- `/strategies/_plans/251019_v20_simplified_adaptive.plan.md`
- `/strategies/_results/251019_v19_v20_comprehensive_analysis.md` (본 문서)

### 자동화 도구
- `/automation/run_multi_year_backtest.py` (2022-2025 자동 백테스팅)
- `/automation/analyze_multi_year_results.py` (4년 통합 분석)

---

## 다음 단계

### 즉시 실행 (선택)

1. **v21 개발** (장기 보유 전략)
   - 컨셉: 상승장 6개월 보유, Trailing Stop 40%
   - 목표: 2023년 +80%, 2024년 +60% 달성

2. **강화학습 시도** (v22~v24)
   - DQN, PPO, A3C
   - 복잡한 패턴 학습 기대

3. **프로젝트 종료 및 결과 정리**
   - CLAUDE.md 최종 업데이트
   - 종합 보고서 작성
   - 교훈 문서화

### 장기 방향

- 비트코인 능동 거래 전략 개발 **중단** 또는 **목표 재설정**
- 다른 접근 방식 탐색 (포트폴리오, 시장 중립, 인덱스 모방)
- 실시간 거래는 **백테스팅 목표 달성 후** 재검토

---

**작성자**: Claude (Orchestrator)
**최종 업데이트**: 2025-10-19
**소요 시간**: 약 5시간 (v19-v20 개발 + 백테스팅 + 분석)
