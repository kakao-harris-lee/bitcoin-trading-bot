# v-a-13: Nested Timeframe Strategy - 설계 문서

**생성일**: 2025-10-22 13:07
**목표**: v-a-11 (+66%) 초과, 목표 +80%+ (웹 검증 전략 기반)

---

## 핵심 아이디어 💡

**"장타의 시그널 안에서 단타를 사고 파는것을 정교하게 만들어서 수익을 높인다"**

### v-a-11 한계점
```
1. 낮은 승률: 22-44% (단일 진입점)
2. Sideways 장기 보유: 20-30일 → 변동성 노출
3. 기회 놓침: Day 시그널만 → 하루 1회 체크
4. 고정 TP: 6%/12%/20% 대기 → 중간 상승 놓침
```

### v-a-13 개선 방향
```
✅ 멀티 진입: Day 시그널 기간 내 4H/1H 반복 진입
✅ 빠른 회전: 단타 TP 2-5% → 복리 극대화
✅ 승률 향상: 정밀 타이밍 (1H RSI < 30)
✅ 리스크 분산: 작은 포지션 × 여러 번
```

---

## Web Research 검증 ✅

### 업계 베스트 프랙티스
```yaml
출처: Coinrule, TradeSanta, ZenLedger (2024)

1. Multi-Timeframe RSI Scalping:
   - 45분 타임프레임 최고 성과
   - 5분도 효과적

2. 3-Layer 접근법:
   Higher TF (Day): 트렌드 방향 설정
   Medium TF (4H): 진입 구간 정의
   Lower TF (1H): 정밀 진입/청산

3. 타임프레임 비율:
   - 1:4~1:6 비율 권장
   - Day → 4H (1:6) → 1H (1:4)

4. 검증된 지표:
   - RSI (과매도/과매수)
   - Moving Averages (추세)
   - Bollinger Bands (변동성)
```

---

## v-a-13 아키텍처

### Layer 1: Day Signal (Macro Trend)
```python
역할: 전체 트렌드 방향 설정 (BULL/SIDEWAYS/BEAR)
데이터: bitcoin_day

Entry:
  - v-a-11과 동일 (4종 전략)
  - Sideways 시그널 → 4H/1H 레벨로 전달

Exit:
  - Day 레벨 손절만 (-10%)
  - 개별 4H/1H 거래는 독립적 청산
```

### Layer 2: 4H Execution (Medium-Term)
```python
역할: Day 시그널 기간 내 중단타 실행
데이터: bitcoin_minute240

Entry 조건 (Day Sideways 신호 내):
  1. RSI < 35 (4H 과매도)
  2. MACD 골든크로스 or MACD > 0
  3. BB Position < 0.3 (하단 근처)
  4. Volume ratio >= 1.2

Exit:
  - TP1: +3% (50% 청산)
  - TP2: +6% (50% 청산)
  - SL: -1.5%
  - Trailing: 고점 -1%
  - Timeout: 7일 (168시간)

Position: Day 신호당 최대 3회 진입
```

### Layer 3: 1H Execution (Short-Term)
```python
역할: Day 시그널 기간 내 단타 실행
데이터: bitcoin_minute60

Entry 조건 (Day Sideways 신호 내):
  1. RSI < 30 (1H 극단 과매도)
  2. Stoch K < 20
  3. BB Position < 0.2 (극단 하단)
  4. Volume ratio >= 1.5

Exit:
  - TP1: +2% (60% 청산)
  - TP2: +4% (40% 청산)
  - SL: -1%
  - Trailing: 고점 -0.7%
  - Timeout: 2일 (48시간)

Position: Day 신호당 최대 5회 진입
```

---

## Position Sizing 전략

### 자본 배분
```yaml
Day 신호 1개당 총 자본: 50%

Layer 2 (4H):
  - 개별 포지션: 12.5% (4H당)
  - 최대 3회 → 총 37.5%

Layer 3 (1H):
  - 개별 포지션: 10% (1H당)
  - 최대 5회 → 총 50%

동시 보유 제한:
  - Day 1개 신호 내 최대 자본 50%
  - 4H + 1H 동시 보유 가능
```

### 복리 효과 극대화
```
v-a-11: 240회 거래 (Day만)
v-a-13: 240회 (Day) × (3+5)회 (4H+1H) = 1,920회 ⚡

복리 회전율: 8배 증가
예상 효과: 작은 수익(2-3%) × 높은 회전 = 누적 대폭 증가
```

---

## 예상 성과 시뮬레이션

### 시나리오 1: 보수적
```
Day 시그널: 40개/년
4H 진입: 40 × 2회 = 80회
1H 진입: 40 × 3회 = 120회
총 거래: 200회

평균 수익:
  4H: +3.5% (승률 55%)
  1H: +2.2% (승률 60%)

복리 계산:
  (1.035^44) × (1.022^72) = 8.76 → +776%

손실 반영 (-30% 실패):
  +776% × 0.7 = +543%
```

### 시나리오 2: 현실적
```
총 거래: 150회

복리:
  (1.03^33) × (1.02^90) = 4.21 → +321%

손실 반영:
  +321% × 0.6 = +193%
```

### 시나리오 3: 비관적
```
총 거래: 100회

복리:
  (1.025^100) = 11.81 → +1,081%

손실 반영 (승률 50%):
  +1,081% × 0.5 = +541%

손절 반영 (-20%):
  +541% × 0.8 = +432%
```

### 목표
```
최소: +80% (v-a-11 +66% 초과)
현실: +150-200%
낙관: +300-500%
```

---

## 핵심 개선 포인트

### 1. 승률 향상
```
v-a-11: 단일 진입 → 22-44% 승률
v-a-13: 정밀 타이밍 (1H RSI<30) → 55-65% 예상
```

### 2. 복리 회전율 극대화
```
v-a-11: 연 40회 거래
v-a-13: 연 150-200회 거래 (4-5배 증가)
```

### 3. 리스크 분산
```
v-a-11: 50% 포지션 × 1회
v-a-13: 10-12.5% 포지션 × 8회
```

### 4. 중간 수익 포착
```
v-a-11: 6%/12%/20% 고정 대기
v-a-13: 2%/3%/4% 빠른 익절 → 복리 재투자
```

---

## 구현 계획

### Phase 1: 데이터 준비
```bash
1. bitcoin_minute240, bitcoin_minute60 로드
2. Day 시그널 파일 읽기 (v-a-11 재사용)
3. 4H, 1H 지표 계산 (RSI, MACD, BB, Stoch)
```

### Phase 2: Signal Generator
```python
strategies/v-a-13/
├── generate_signals_4h.py  # 4H 시그널 생성
├── generate_signals_1h.py  # 1H 시그널 생성
└── signal_extractors_nested.py  # 공통 로직
```

### Phase 3: Nested Backtester
```python
strategies/v-a-13/
└── backtest_nested.py
    - Day 신호 로드
    - 각 Day 신호 기간 내:
        - 4H 시그널 체크 (최대 3회)
        - 1H 시그널 체크 (최대 5회)
    - 포지션 관리 (동시 보유 제한)
    - 복리 계산
```

### Phase 4: Evaluation
```
- 2020-2025 연도별 백테스팅
- v-a-11 대비 개선율 측정
- 목표: +66% → +80%+ (21% 증가)
```

---

## 리스크 관리

### 과매매 방지
```
- Day 신호당 최대 8회 제한 (4H×3 + 1H×5)
- 동일 캔들 중복 진입 금지
- 72시간 재진입 쿨다운 (같은 레벨)
```

### 자본 보호
```
- Day 레벨 손절 -10% (전체 청산)
- 개별 거래 손절: 4H -1.5%, 1H -1%
- 최대 손실: 50% (자본) × 10% = -5% (Day당)
```

### 승률 목표
```
4H: 55%+ (중단타)
1H: 60%+ (정밀 타이밍)
종합: 58%+ (v-a-11 22-44% 대비 2배)
```

---

## 다음 단계

1. ✅ 설계 문서 작성
2. ⏳ 4H, 1H Signal Generator 구현
3. ⏳ Nested Backtester 구현
4. ⏳ 2020-2025 백테스팅
5. ⏳ v-a-11 대비 성과 분석

---

**설계 승인 대기** ⏸️
승인 시 즉시 구현 시작합니다!
